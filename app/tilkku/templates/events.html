{% block content %}
{% load static %}
<style>
.event-item {
    cursor: pointer;
}
.input-item {
    cursor: pointer;
    font-weight: 400;
}
</style>

<div class="content">
    <button class="button is-small"><i class="fa fa-plus"></i></button>
</div>

<div class="content" style="height: calc(100% - 20px); overflow-y: clip;">
    <div id="events-topic-box" style="height: calc(100% - 32px); overflow: auto;">
    </div>
</div>

<div id="topic-template" class="topic-item box p-2 mb-2 notification is-info">
    <div class="columns">
        <div class="column is-1 is-size-7">
            <i class="fa fa-info-circle" style="cursor:pointer" title="Lisätiedot"></i>
            <i class="fa fa-flag" style="cursor:pointer" title="Sijainti"></i>
            <i class="fa fa-check" style="cursor:pointer" title="Kuittaa"></i>
        </div>
        <div class="column">
            <h1 class="topic-title title is-5"></h1>
            <h2 class="topic-description subtitle is-7"></h2>
        </div>
        <div class="column is-1 is-size-7 m-1" style="text-align: center;">
            <i class="fa fa-clipboard-list" title="Merkintöjä"></i>
            <p class="topic-notes-count"></p>
        </div>
    </div>
</div>

<div id="topic-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Aiheen lisäys</p>
            <button class="delete" aria-label="close" onclick="topic_modal_close();"></button>
        </header>
        <section class="modal-card-body">
            <div class="field">
                <label class="label">Otsikko</label>
                <div class="control">
                    <input class="input" type="text" id="topic-modal-name">
                </div>
            </div>
            <div class="field">
                <label class="label">Kuvaus</label>
                <div class="control">
                    <textarea class="textarea" id="topic-modal-description"></textarea>
                </div>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-primary" onclick="topic_modal_save();">Tallenna</button>
            <button class="button" onclick="topic_modal_close();">Peruuta</button>
        </footer>
    </div>
</div>

<script>
$(function() {
    $("#events-input-box").sortable({
        connectWith: ".event-item",
    }).disableSelection();
    $("#events-event-box").sortable({
        connectWith: "#map",
    }).disableSelection();

    $(".event-item").droppable({
        accept: ".input-item",
        drop: function(event, ui) {
            console.log(event);
            console.log(ui);/*
            var item = ui.draggable;
            var event_id = $(this).attr("id");
            var input_id = item.attr("id");
            $.ajax({
                url: "/tilkku/events/add_input",
                type: "POST",
                data: {
                    event_id: event_id,
                    input_id: input_id,
                },
                success: function(data) {
                    if (data.success) {
                        item.remove();
                    }
                }
            });*/
        }
    });
});

function get_events() {
    $.ajax({
        url: "api/topics/?status=OP",
        type: "GET",
        success: function(data) {
            console.log(data);
            $("#events-topic-box").html("");
            data.forEach(function(topic) {
                var topic_item = $("#topic-template").clone();
                topic_item.attr("id", topic.id);
                topic_item.find(".topic-title").text(topic.name);
                topic_item.find(".topic-description").text(topic.description);
                topic_item.find(".topic-notes-count").text(topic.notes.length);
                $("#events-topic-box").append(topic_item);
            });
        }
    });
}
get_events();

var event_timer = setInterval(get_events, 10000);

</script>
{% endblock %}