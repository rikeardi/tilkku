{% block content %}
<style>
.chat-window {
    height: calc(100% - 50px);
    overflow-y: auto;
    margin-bottom: 5px;
    position: relative;
}
.chat {
    list-style: none;
    background: none;
    position: absolute;
    bottom: 0;
    width: 100%;
    height: auto;
    max-height: 100%;
    margin: 0 !important;
}
.chat li {
    padding: 0.5rem;
    overflow: hidden;
    display: flex;
}
.self {
    justify-content: flex-end;
    align-items: flex-end;
}
.self > .msg {
    order: 1;
    border-bottom-right-radius: 0px;
    background-color: #3e8ed0;
    color: #fff;
}
.other > .msg {
    order: 1;
    border-top-left-radius: 0px;
    background-color: #eff5fb;
    color: #296fa8;
}
.other > .name {
    font-size: 0.7rem;
}
.msg {
    min-width: 50px;
    padding: 0.5rem !important;
    font-size: .75rem !important;
    box-shadow: 3px 3px 5px #ccc;
    border-radius: 10px;
}
.msg p {
    margin-bottom: 3px;
}
.msg time {
    font-size: 0.5rem;
    color: #ccc;
    cursor: default;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}
.self time {
    float: right;
}
.other time {
    float: left;
}

</style>
<div class="chat-window">
    <ol class="chat">
        <li class="other">
            <div class="msg">
                <span class="name">Pena</span>
                <p>Moro!</p>
                <time>10:00</time>
            </div>
        </li>
        <li class="self">
            <div class="msg">
                <p>No moi!</p>
                <time>10:01</time>
            </div>
        </li>
        <li class="other">
            <div class="msg">
                <span class="name">Pena</span>
                <p>Miten menee?</p>
                <time>10:05</time>
            </div>
        </li>
        <li class="self">
            <div class="msg">
                <p>Paskaaks tässä!</p>
                <time>10:07</time>
            </div>
        </li>
        <li class="other">
            <div class="msg">
                <span class="name">Pena</span>
                <p>Ootko kuullu keinosesta?</p>
                <time>10:09</time>
            </div>
        </li>
        <li class="self">
            <div class="msg">
                <p>En, mitäs keinone?</p>
                <time>10:11</time>
            </div>
        </li>
        <li class="other">
            <div class="msg">
                <span class="name">Pena</span>
                <p>No se oli kuule lähteny kalaan ja vetäny kunnon naamat. Sit se oli ajellu vähä autolla ja kärähtäny ratista.</p>
                <time>10:13</time>
            </div>
        </li>
        <li class="self">
            <div class="msg">
                <p>Ei hitto, tyhymä jätkä!</p>
                <time>10:15</time>
            </div>
        </li>
    </ol>
</div>
<input class="input" type="text" />

<script>
const chatSocket = new WebSocket(
    'ws://'
    + window.location.host
    + '/ws/chat/opke/'
);

chatSocket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    console.log(data);
}

chatSocket.onclose = function(e) {
    console.error('Chat socket closed unexpectedly');
};

$('#chat-message-input').onkeyup = function(e) {
    if (e.keyCode === 13) {  // enter, return
        $('#chat-message-submit').click();
    }
};

$('#chat-message-submit').onclick = function(e) {
    const messageInputDom = $('#chat-message-input');
    const message = messageInputDom.value;
    chatSocket.send(JSON.stringify({
        'message': message
    }));
    messageInputDom.value = '';
};
</script>
{% endblock %}