{% extends "base.html" %}
{% block content %}
<script>
var settings = {
    menu: "visible",
    tool: "chat",
    map: {
        center: {
            lat: 61.205,
            lng: 25.130
        },
        zoom: 15,
        server: 0
    }
}

function refresh_settings() {
    localStorage.setItem('settings', JSON.stringify(settings));
}

if(localStorage.getItem('settings') == null) {
    refresh_settings();
} else {
    settings = JSON.parse(localStorage.getItem('settings'));
}
</script>
<div id="map" style="width: 100%; height: 100%; position: fixed; top: 0; left: 0;"></div>
<div class="columns" style="height: 100%; margin: 0px;">
    <div class="column" style="width: auto; min-width: 66%;">
        <div style="width: 32px; float: right;">
            {% include 'toolbox.html' %}
        </div>
    </div>
    <div id="front-tools" class="column is-third" style="z-index: 2;">
        <div class="box p-0" style="height: calc(100% - 10px);">
            {% include 'tools.html' %}
        </div>
    </div>
</div>
<script>
var home = [61.205, 25.130];
var home_zoom = 15;
var map = L.map('map').setView(settings.map.center, settings.map.zoom);

map_servers = JSON.parse({{ map_servers | safe }});
console.log(map_servers);
/*[
    {
        name: "Peruskartta",
        layer: L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: "<a href='https://www.openstreetmap.org/copyright' target='_blank'>&copy; OpenStreetMap contributors</a>"
        })
    },
    {
        name: "Ulkoilukartta",
        layer: L.tileLayer("https://api.maptiler.com/maps/outdoor/{z}/{x}/{y}.png?key=x5HQNRqipBYmO7CdoEui", {
            attribution: "<a href='https://www.maptiler.com/copyright/' target='_blank'>&copy; MapTiler</a> <a href='https://www.openstreetmap.org/copyright' target='_blank'>&copy; OpenStreetMap contributors</a>"
        })
    },
    {
        name: "Satelliittikuva",
        layer: L.tileLayer("https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=x5HQNRqipBYmO7CdoEui", {
            attribution: "<a href='https://www.maptiler.com/copyright/' target='_blank'>&copy; MapTiler</a> <a href='https://www.openstreetmap.org/copyright' target='_blank'>&copy; OpenStreetMap contributors</a>"
        })
    }
]*/

var map_background = map_servers[settings.map.server].layer.addTo(map);

function map_set_bg() {
    map_background.remove();
    map_background = map_servers[settings.map.server].layer.addTo(map);
}

map.on("moveend", function () {
    settings.map.center = map.getCenter();
    settings.map.zoom = map.getZoom();
    refresh_settings();
});

var kerros = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              25.119574069976807,
              61.2059092130942
            ],
            [
              25.120646953582764,
              61.20526841344715
            ],
            [
              25.12120485305786,
              61.20580585919436
            ],
            [
              25.120861530303955,
              61.206115919876225
            ],
            [
              25.119574069976807,
              61.2059092130942
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              25.123436450958252,
              61.20578518837368
            ],
            [
              25.123350620269775,
              61.20558881490057
            ],
            [
              25.124423503875732,
              61.205630156786164
            ],
            [
              25.124144554138184,
              61.205898877719484
            ],
            [
              25.123436450958252,
              61.20578518837368
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              25.122814178466793,
              61.20775919052309
            ],
            [
              25.123543739318844,
              61.20741814140306
            ],
            [
              25.123929977416992,
              61.2079038769126
            ],
            [
              25.123286247253418,
              61.2080175586094
            ],
            [
              25.122878551483154,
              61.20798655455096
            ],
            [
              25.122814178466793,
              61.20775919052309
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              25.115625858306885,
              61.20641564230012
            ],
            [
              25.116162300109863,
              61.20634329576932
            ],
            [
              25.116376876831055,
              61.20658100517492
            ],
            [
              25.115861892700195,
              61.206622345757935
            ],
            [
              25.115625858306885,
              61.20641564230012
            ]
          ]
        ]
      }
    }
  ]
}

L.geoJSON(kerros).addTo(map);
</script>
{% include 'settings.html' %}
{% endblock %}